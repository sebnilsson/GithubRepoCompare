<template>
    <require from="./value-converters/date-format"></require>
    <require from="./value-converters/number-format"></require>

    <div class="panel panel-primary">
        <div class="panel-heading">
            <h2 class="panel-title">Repositories</h2>
        </div>
        <div class="panel-body">
            <form class="form-inline">
                <div class="form-group">
                    <label for="repo-full-name">Full Name</label>
                    <input id="repo-full-name" type="text" value.bind="repoFullName" class="form-control"/>
                </div>
                <button type="submit" click.trigger="addRepo(repoFullName)"
                        disabled.bind="isRepoLoading || !isRepoFullNameValid(repoFullName)"
                        class="btn btn-primary">
                    <span class="glyphicon glyphicon-plus"></span>
                    Add
                </button>
            </form>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Full Name</th>
                    <th>Created</th>
                    <th>Size</th>
                    <th>Watchers</th>
                    <th>Subscribers</th>
                    <th>Forks</th>
                    <th>Open Issues</th>
                    <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <tr repeat.for="repo of repos.items">
                    <td>
                        <img src.bind="repo.owner.avatar_url ? repo.owner.avatar_url : 'https://avatars.githubusercontent.com/u/9919?v=3'"
                             class="repo-owner-avatar"/>
                        ${repo.name}
                    </td>
                    <td>
                        <a href.bind="repo.html_url">
                            <code>${repo.full_name}</code>
                        </a>
                    </td>
                    <td title="${repo.created_at | dateFormat:'YYYY-MM-DD HH:mm:ss'}">
                        ${repo.created_at | dateFormat:'YYYY-MM-DD'}
                    </td>
                    <td>
                        ${repo.size | numberFormat:'0.00b'}
                    </td>
                    <td>
                        ${repo.watchers_count | numberFormat:'0,0'}
                    </td>
                    <td>
                        ${repo.subscribers_count | numberFormat:'0,0'}
                    </td>
                    <td>
                        ${repo.forks_count | numberFormat:'0,0'}
                    </td>
                    <td>
                        ${repo.open_issues_count | numberFormat:'0,0'}
                    </td>
                    <td>
                        <a click.trigger="updateRepo(repo)" title="Update"
                           class="btn btn-info btn-sm">
                            <span class="glyphicon ${!repo.isUpdating ? 'glyphicon-refresh' : 'glyphicon-hourglass'} ${repo.isUpdating ? 'disabled' : ''}"></span>
                        </a>
                        <a click.trigger="removeRepo(repo)" title="Remove"
                           class="btn btn-danger btn-sm">
                            <span class="glyphicon glyphicon-trash"></span>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</template>