<template>
    <require from="./value-converters/date-format"></require>
    <require from="./value-converters/date-format-relative"></require>
    <require from="./value-converters/number-format"></require>
    <require from="./custom-attributes/collapse"></require>

    <div class="panel panel-info">
        <div class="panel-heading">
            <h2 class="panel-title">
                <button collapse="target.bind: collapseTarget;
                        icon.bind: collapseIcon;
                        show.bind: collapseShow"
                        class="btn btn-link btn-xs">
                    <span element.ref="collapseIcon" class="glyphicon"></span>
                </button>

                Repositories
            </h2>
        </div>
        <div element.ref="collapseTarget" class="collapse ${collapseShow ? 'in' : '' & oneTime}">
            <div class="panel-body">
                <form class="form-inline">
                    <div class="form-group">
                        <label for="repo-full-name">Full Name</label>
                        <input id="repo-full-name" type="text" placeholder="owner/repo"
                               disabled.bind="isRepoLoading" value.bind="repoFullName"
                               class="form-control"/>
                    </div>
                    <button type="submit" click.trigger="addRepo(repoFullName)"
                            disabled.bind="isRepoLoading || !isRepoFullNameValid"
                            class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span>
                        Add
                    </button>
                </form>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead>
                    <tr class="active">
                        <th>Repo</th>
                        <th>Created</th>
                        <th>Size</th>
                        <th>Watchers</th>
                        <th>Subscribers</th>
                        <th>Pull requests</th>
                        <th>Forks</th>
                        <th>Open Issues</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- title="Updated ${repo.dataUpdated | dateFormatRelative} (${repo.dataUpdated | dateFormat:'YYYY-MM-DD HH:mm:ss'})" -->
                    <tr repeat.for="repo of repos.items">
                        <td>
                            <a href.one-time="repo.html_url">
                                <img src.one-time="repo.owner.avatar_url ? repo.owner.avatar_url : 'https://avatars.githubusercontent.com/u/9919?v=3'"
                                     class="repo-owner-avatar"/>
                            </a>
                            &nbsp;
                            <code>
                                <a href.one-time="repo.html_url">${repo.full_name}</a>
                            </code>
                        </td>
                        <td title="${repo.created_at | dateFormat:'YYYY-MM-DD HH:mm:ss'}">
                            ${repo.created_at | dateFormat:'YYYY-MM-DD'}
                        </td>
                        <td class="text-right">
                            ${repo.size | numberFormat:'0.00b'}
                        </td>
                        <td class="text-right">
                            ${repo.watchers_count | numberFormat:'0,0'}
                        </td>
                        <td class="text-right">
                            ${repo.subscribers_count | numberFormat:'0,0'}
                        </td>
                        <td class="text-right">
                            ${repo.stats.pullRequestsCount | numberFormat:'0,0'}
                        </td>
                        <td class="text-right">
                            ${repo.forks_count | numberFormat:'0,0'}
                        </td>
                        <td class="text-right">
                            ${repo.open_issues_count | numberFormat:'0,0'}
                        </td>
                        <td>
                            <button click.trigger="updateRepo(repo)" title="Update (Last: ${repo.dataUpdated | dateFormatRelative})"
                                    class="btn btn-sm ${isRepoOutdated(repo) ? 'btn-warning' : 'btn-success'} ${repo.isUpdating ? 'disabled' : ''}">
                                <span class="glyphicon ${!repo.isUpdating ? 'glyphicon-refresh' : 'glyphicon-hourglass'} ${repo.isUpdating ? 'disabled' : ''}"></span>
                            </button>
                            &nbsp;
                            <button click.trigger="removeRepo(repo)" title="Remove"
                                    class="btn btn-danger btn-sm">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                            &nbsp;
                            <button collapse="target.bind: collapseTarget; icon.bind: collapseIcon; show.bind: repo.collapseShow" 
                                    class="btn btn-link btn-xs">
                                <span element.ref="collapseIcon" class="glyphicon"></span>
                            </button>
                            <div element.ref="collapseTarget" class="collapse">
                                <small>
                                    <strong>Updated:</strong>
                                    <code>
                                        <em>${repo.dataUpdated | dateFormatRelative & signal:'outdated-signal'}</em>
                                        <br/>
                                        (${repo.dataUpdated | dateFormat:'YYYY-MM-DD HH:mm:ss'})
                                    </code>
                                </small>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</template>